{% extends 'base.html' %}
{% block title %}–ö–Ω–∏–≥–∏{% endblock %}
{% block header %}–°–ø–∏—Å–æ–∫ –ö–Ω–∏–≥{% endblock %}
{% block content %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'library_app/css/book.css' %}">
    <form id="searchForm" method="GET" action="{% url 'book' %}">
    <input
        type="text"
        id="searchInput"
        name="q"
        placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä–∞ –∞–±–æ –∂–∞–Ω—Ä..."
        value="{{ query|default_if_none:'' }}"
        autocomplete="off"
    >
    <button type="submit">–ü–æ—à—É–∫</button>
    </form>
    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–ê–≤—Ç–æ—Ä–∏</th>
                <th>–í–∏–¥–∞–≤–Ω–∏—Ü—Ç–≤–æ</th>
                <th>–†—ñ–∫ –≤–∏–¥–∞–Ω–Ω—è</th>
                <th>–ú–æ–≤–∞</th>
                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
            <tr>
                <td>{{ book.name }}</td>
                <td>
                    {% for author in book.authors.all %}
                        {{ author.full_name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>{{ book.publishing.name }}</td>
                <td>{{ book.year_of_publication }}</td>
                <td>{{ book.language }}</td>
                <td>{{ book.number_of_pages }}</td>
                <td>
                    {% for category in book.categories.all %}
                        {{ category.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% block extra_js %}
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ jQuery —Ç–∞ jQuery UI -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/smoothness/jquery-ui.css">

<script>
$(document).ready(function() {
    console.log("‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ");

    $("#searchInput").autocomplete({
        source: function(request, response) {
            console.log("üîç –ù–∞–¥—Å–∏–ª–∞—î–º–æ –∑–∞–ø–∏—Ç: " + request.term);
            $.ajax({
                url: "{% url 'autocomplete_books' %}",
                data: { q: request.term },
                dataType: "json",
                success: function(data) {
                    console.log("üìå –û—Ç—Ä–∏–º–∞–Ω—ñ –¥–∞–Ω—ñ:", data);
                    response(data);
                },
                error: function(xhr, status, error) {
                    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É:", status, error);
                }
            });
        },
        minLength: 1,
        select: function(event, ui) {
            $("#searchInput").val(ui.item.value);
            $("#searchForm").submit();
        }
    });
});
</script>
{% endblock %}

{% endblock %}